---
title: "Numerical data"
subtitle: "Visualization and summary statistics (part 2)"
date: "September 18, 2024"
title-slide-attributes:
    data-background-image: "figs/bikeshare-plots.png"
    data-background-size: contain
    data-background-opacity: "0.2"
format: 
  revealjs:
    theme: custom.scss
    transition: none
    incremental: true
    scrollable: true
editor: visual
editor_options: 
  chunk_output_type: console
draft: false
---

## Recap

We learned about the sample mean $\bar{x}$, the sample variance $s^2 = \frac{1}{n-1} \sum_{i=1}^{n} (x_{i} - \bar{x})^2$, and the sample standard deviation $s = \sqrt{s^2}$

-   Why care about standard deviation (SD)? Describes how far data are distributed from their mean

-   Usually (but not always!!) about 70% of the data will be within one SD of the mean, and 95% will be within two SDs

    -   These percentages are not precise, but are useful for intuition

    -   We will come back to this later in semester

## More visualizations and statistics

```{r echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, messabundance = F)
library(tidyverse)
library(readr)
plot_theme <- theme(text = element_text(size = 16))
```

```{r echo = F}
insurance <- read_csv("data/insurance.csv")

ggplot(insurance, aes(x = charges)) +
  geom_histogram() +
  geom_vline(xintercept = mean(insurance$charges), col = "orange", size = 2) +
  theme(text = element_text(size = 20)) +
  labs(caption = "Orange line denotes sample mean")
  # facet_wrap(~smoker)
```

We know how to calculate some summary statistics and interpret them alongside the histogram. But wouldn't it be great if we had a visualization that directly displays some summary statistics?

## Boxplot

Another commonly used visualization to display the distribution of a numerical variable is the **boxplot**. Boxplots are created using five statistics and identify unusual observations.

```{r}
ggplot(insurance, aes(x = charges)) +
  geom_boxplot() +
  scale_y_continuous(NULL, breaks = NULL) +
  xlab("Charges ($)") +
  theme(text = element_text(size = 20))
```

-   Does the orientation (vertical or horizontal) matter?

## Median

-   The (sample) **median** $m$ is another common measure of center of a distribution. It is the value of the data distribution where 50% of the data are less than $m$ and 50% of the data are greater than $m$.

    -   If we order the data from smallest to largest, the median is the value in the middle.
    -   If the number of observations $n$ is even, then there will be two values in the middle, and the median is taken as their average.

-   ::: discuss
    Consider the following data: $\boldsymbol{x} =116, 114, 112, 120, 108, 113, 123, 118, 119, 115$. What is the median?
    :::

-   The median is also known the 50th percentile: 50% of the data fall below $m$

## Quartiles

-   The 25th percentile is the value of data with 25% of values below it. Special name: **first quartile** $Q_{1}$

-   The 75th percentile is the value of data with 75% of values below it. Special name: **third quartile** $Q_{3}$

-   ::: discuss
    What percent of the data fall between $Q_{1}$ and $Q_{3}$? What percent of the data fall between $Q_{1}$ and the median?
    :::

-   How to calculate? Suppose we have $2n$ (even) or $2n + 1$ (odd) number of values

    -   $Q_{1}$ is the median of the $n$ smallest values

    -   $Q_{3}$ is the median of the $n$ largest values

-   ::: discuss
    What are $Q_{1}$ and $Q_{3}$ of the data $\boldsymbol{x}$?
    :::

## Interquartile range

The **interquartile range** (**IQR**) is another measure of variability/spread in the data.

$$
IQR = Q_{3} - Q_{1}
$$

-   The more variable the data, the larger the IQR
-   What is the IQR of the data $\boldsymbol{x}$?

::: notes
IQR are not the values themselves, but rather, the spread of the middle 50% of the data. Interpretation once again depends on the scale of the data.

Q3 = 119 and Q1 = 113 -\> IQR = 6
:::

## Creating the boxplot

-   The "box" part of the boxplot is created using $Q_{1}$, $m$, and $Q_{3}$

-   Then we draw out **whiskers** from the box that attempt to capture data outside the IQR

    -   How long should the whiskers be? There isn't a fixed rule, but $1.5 \times IQR$ below $Q_1$ and above $Q_{3}$ is common

-   Lastly, we add dots for any cases that lie beyond the whiskers

    -   These points are unusually high/low compared to the rest of the data and are worth identifying as *potential* outliers

    -   An **outlier** is an observation that appears extreme relative to the rest of the data

-   Let's draw a boxplot for the data $\boldsymbol{x}$!

## Another boxplot

Now a boxplot of the estimated weights from the previous class!

## A note on outliers

-   ::: discuss
    Why are we interested in identifying outliers?
    :::

    -   Identifying strong skew

    -   Identifying possible data collection/data entry errors

    -   Providing insight into interesting properties of the data

-   Are outliers necessarily indicative of a problem in the data?

## Histograms vs boxplots

::: discuss
What characteristics of the distribution are apparent in the histogram and not in the box plot? What characteristics are apparent in the box plot but not in the histogram?
:::

![](figs/04-hist_v_boxplot.png){fig-align="center"}

## Robust statistics

```{r}
x <- c(116, 114, 112, 120, 108, 113, 123, 118, 119, 115)
x2 <- c(x, 170)
```

-   In the data $\boldsymbol{x}$ that we have been working with, we have the following sample statistics:

::: fragment
$\qquad \bar{x} =$ \_\_\_\_\_, $s =$ \_\_\_\_\_, $m =$ `r round(median(x), 1)` , $IQR =$ 6
:::

-   ::: discuss
    Suppose we actually observed an additional data point with a value of $170$. What are the sample statistics with this additional data point? How do they compare to the values above?

    $\bar{x}' =$ \_\_\_\_\_, $s' =$ \_\_\_\_\_, $m' =$ \_\_\_\_\_, $IQR' =$ \_\_\_\_\_
    :::

-   **Robust statistics** are statistics that are minimally affected by extreme values

    -   Which of the statistics above would be considered robust?

-   ::: discuss
    When should the mean be similar to the median (and the standard deviation similar to the IQR)? Why not compare IQR to the sample variance?
    :::

::: notes
m' = 116

Q1' = 113, Q3' = 120, IQR' = 7
:::

## Mean vs. Median

```{r}
ggplot(insurance, aes(x = charges)) +
  geom_histogram() +
  geom_vline(xintercept = mean(insurance$charges), col = "orange") +
   geom_vline(xintercept = median(insurance$charges), col = "blue")+
  plot_theme +
  ggtitle("Insurance charges") +
  labs(caption = "Orange = sample mean, blue = sample median")
```

Which is better? The mean or the median?

````{=html}
<!--
## Comparing numerical data across groups

-   While we haven't yet discussed categorical data, it is common to want to visualize the distribution of a numerical variable across different groups/levels of a categorical variable

```{r}
p1 <- ggplot(insurance, aes(y = smoker, x = charges)) +
  geom_boxplot() +
  plot_theme

p2 <- ggplot(insurance, aes(x = charges, col = smoker, fill = smoker)) +
  geom_density(alpha = 0.3) +
  plot_theme

p3 <- ggplot(insurance, aes(x = charges)) +
  geom_histogram()+
  facet_wrap(~smoker) +
  theme(text =element_text(size = 14),
        axis.text.x = element_text(angle = 45))

gridExtra::grid.arrange(grobs =list(p1,p2,p3), ncol = 2)
```
-->
````

## Transforming data

-   When data are strongly skewed or take on an "inconvenient" range of values, we might transform them so they are easier to work with

-   A **transformation** rescales the data using a function

    -   e.g. $f(x) = e^x$, $f(x) = \log_{10}(x)$, $f(x) = \ln(x)$, $f(x) = \sqrt{x}$

    -   The exact transformation you choose depends heavily on the data!!

::: fragment
```{r fig.height=3}
p1 <- ggplot(insurance, aes(x = charges)) +
  geom_histogram(bins = 20) +
  plot_theme

p2<- ggplot(insurance, aes(x = log(charges, base = 10))) +
  geom_histogram(bins = 20) +
  xlab(expression("log" [10] ~ "(charges)")) +
  plot_theme

gridExtra::grid.arrange(grobs =list(p1,p2), ncol = 2)
```
:::

## Live code

-   `median()`

-   Boxplots in base R
